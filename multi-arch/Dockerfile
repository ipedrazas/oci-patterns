FROM alpine:3.17@sha256:ff6bdca1701f3a8a67e328815ff2346b0e4067d32ec36b7992c1fdc001dc8517 as base

ARG TARGETPLATFORM
ARG TARGETOS
ARG TARGETARCH
ARG TARGETVARIANT

ARG BUILDPLATFORM
ARG BUILDOS
ARG BUILDARCH
ARG BUILDVARIANT

RUN <<EOF

echo """
ARGS in docker build - ${TARGETOS}-${TARGETARCH}
-------------------
TARGETPLATFORM    : $TARGETPLATFORM
TARGETOS          : $TARGETOS
TARGETARCH        : $TARGETARCH
TARGETVARIANT     : $TARGETVARIANT

BUILDPLATFORM     : $BUILDPLATFORM
BUILDOS           : $BUILDOS
BUILDARCH         : $BUILDARCH
BUILDVARIANT      : $BUILDVARIANT

File created on $(date)
""" > /${TARGETOS}-${TARGETARCH}.txt
EOF


FROM scratch
ARG TARGETOS
ARG TARGETARCH

COPY --from=base /${TARGETOS}-${TARGETARCH}.txt ./${TARGETOS}-${TARGETARCH}.txt