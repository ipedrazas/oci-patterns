FROM alpine:3.17@sha256:c41ab5c992deb4fe7e5da09f67a8804a46bd0592bfdf0b1847dde0e0889d2bff as base

ARG TARGETPLATFORM
ARG TARGETOS
ARG TARGETARCH
ARG TARGETVARIANT

ARG BUILDPLATFORM
ARG BUILDOS
ARG BUILDARCH
ARG BUILDVARIANT

RUN <<EOF

echo """
ARGS in docker build - ${TARGETOS}-${TARGETARCH}
-------------------
TARGETPLATFORM    : $TARGETPLATFORM
TARGETOS          : $TARGETOS
TARGETARCH        : $TARGETARCH
TARGETVARIANT     : $TARGETVARIANT

BUILDPLATFORM     : $BUILDPLATFORM
BUILDOS           : $BUILDOS
BUILDARCH         : $BUILDARCH
BUILDVARIANT      : $BUILDVARIANT

File created on $(date)
""" > /${TARGETOS}-${TARGETARCH}.txt
EOF


FROM scratch
ARG TARGETOS
ARG TARGETARCH

COPY --from=base /${TARGETOS}-${TARGETARCH}.txt ./${TARGETOS}-${TARGETARCH}.txt